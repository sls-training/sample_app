# API設計書

## ユーザーのマイクロポストを返すAPI
※一旦概要部分のみ認証に関する追記を記載（リクエストなどは後ほど追記）

### 概要
- ユーザーのマイクロポストを返すAPI
  - cookieに保存されている暗号化されたユーザーIDと、トークンを使って認証する
    - リクエストを送った時、まず暗号化されたユーザーIDでDBを検索する
	- ユーザーが存在した場合、そのユーザーの※auth_digestとトークンを照合し一致することを確かめる
    - ユーザーが存在しない場合、トークンが一致しない場合はエラーを返す
	- 一致した場合、リクエストの処理を実行する↓

  - ユーザーIDを指定して、ユーザーがDBに存在すればそのユーザーのマイクロポストを返す
    - パラメータとして表示ページ、表示するマイクロポストの数を指定できる
      - 指定しなければ表示ページには1、マイクロポスト数には30が入る
  - マイクロポストは降順で表示される
    - マイクロポストが投稿されていない、もしくは指定したページに表示するマイクロポストがなければ空のjson([])を返す
  - エラーを返す
    - 暗号化されたユーザーIDで検索した結果存在しなかった場合
	- トークンが一致しなかった場合
    - 無効な値、ユーザーが存在しない場合

※auth_digestについてはチュートリアルで作成しているものでは無いため、後に追加します。

### メソッド
- GET

### URI
- /api/v1/users/{user_id}/microposts{page}{per_page}

### パラメータ
| パラメータ名 | 型 | 内容 |
| ----| ---- | ---- |
| user_id | Integer | ユーザーIDを数字で指定 |
| page | Integer | 表示したいページ数を数字で指定<br>デフォルトは1 |
| per_page | Integer | 表示したいマイクロポストの数を数字で指定<br>デフォルトは30<br>表示したページのマイクロポストが指定した数より少なければある分だけを表示

### レスポンス
#### 成功時
##### ステータスコード
- 200

##### レスポンスサンプル
- 表示するマイクロポストが存在する場合
```
{
	"microposts": [
		{
			"id": 295,
			"content": "Possimus facilis repellat odit dolore.",
			"user_id": 1,
			"created_at": "2022-04-18T07:54:54.387Z",
			"updated_at": "2022-04-18T07:54:54.387Z"
		},
		{
			"id": 289,
			"content": "Ut voluptatem sed expedita nam.",
			"user_id": 1,
			"created_at": "2022-04-18T07:54:54.362Z",
			"updated_at": "2022-04-18T07:54:54.362Z"
		},
		{
			"id": 283,
			"content": "Sequi et voluptas quod beatae.",
			"user_id": 1,
			"created_at": "2022-04-18T07:54:54.338Z",
			"updated_at": "2022-04-18T07:54:54.338Z"
		},
  ~~~~ # 省略
		{
			"id": 121,
			"content": "Cumque possimus ipsa quaerat non.",
			"user_id": 1,
			"created_at": "2022-04-18T07:54:53.645Z",
			"updated_at": "2022-04-18T07:54:53.645Z"
		}
	]
}
```

- 表示するマイクロポストが存在しない場合
```
{
  "microposts": []
}
```

#### 失敗時
##### ステータスコード
- 404

##### レスポンスサンプル
```
{
  "error": {
    "status": 404,
    "message": "not found"
  }
}
```

---

## 認証用API

### 概要
- メールアドレスとパスワードを受け取り、ログイン処理を行う
- ログイン成功時にランダムな文字列のトークンを生成（base64）
  - 暗号化したユーザーID、トークンを返す
- ログイン失敗時にエラーを返す

### メソッド
- POST

### URI
- /api/v1/auth

### リクエスト
```
{
  "email": "test@example.com",
  "password":"aiueo123"
}
```

### レスポンス
#### 成功時
##### ステータスコード
- 200

##### レスポンスサンプル
```
{
    "userid": "2d595d992295d487fe691812c556abdf81acf0",
    "token": "Gvt7D0dzmqa4YggJf-SROg"
}
```

#### 失敗時
##### ステータスコード
- 404

#### レスポンスサンプル
```
{
  "error": {
    "status": 404,
    "message": "not found"
  }
}
```
